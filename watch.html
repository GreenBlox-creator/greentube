<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8" />
  <title>GreenTube ‚Äì Odtwarzacz</title>
  <link rel="stylesheet" href="https://cdn.plyr.io/3.7.8/plyr.css" />
  <link rel="stylesheet" href="style.css" />
  <style>
    .player-wrapper {
      max-width: 960px;
      margin: 2rem auto;
    }
    .video-info {
      max-width: 960px;
      margin: 1rem auto;
      font-family: sans-serif;
    }
    .video-info h2 {
      margin-bottom: 0.5rem;
    }
    .video-meta {
      color: #666;
      font-size: 0.9rem;
    }
    .error {
      color: red;
      font-weight: bold;
      white-space: pre-wrap;
    }
  </style>
</head>
<body>

  <!-- MENU -->
  <header class="header">
    <button class="btn icon-btn"><span class="icon">‚ò∞</span></button>
    <div class="logo">GreenTube</div>
    <div class="search">
      <input type="text" placeholder="Szukaj..." />
      <button class="btn icon-btn"><span class="icon">üîç</span></button>
    </div>
    <button class="btn icon-btn"><span class="avatar">U</span></button>
  </header>

  <div class="layout">
    <aside class="sidebar collapsed">
      <nav>
        <ul>
          <li><span class="icon">üè†</span><span class="text">G≈Ç√≥wna</span></li>
          <li><span class="icon">üé•</span><span class="text">Wideo</span></li>
          <li><span class="icon">üìÉ</span><span class="text">Playlisty</span></li>
          <li><span class="icon">‚≠ê</span><span class="text">Subskrypcje</span></li>
        </ul>
      </nav>
    </aside>

    <main class="content">
      <div class="player-wrapper">
        <video id="player" controls playsinline></video>
      </div>
      <div class="video-info">
        <h2 id="videoTitle">≈Åadowanie...</h2>
        <div class="video-meta" id="videoMeta"></div>
      </div>
    </main>
  </div>

  <!-- Firebase + Plyr -->
  <script src="https://cdn.jsdelivr.net/npm/firebase@11.10.0/firebase-app-compat.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/firebase@11.10.0/firebase-firestore-compat.js"></script>
  <script src="https://cdn.plyr.io/3.7.8/plyr.polyfilled.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyDnGKAkzW9w2Y1NBeyasBTY29YYYzFok_A",
      authDomain: "greentube-b93d1.firebaseapp.com",
      projectId: "greentube-b93d1",
      storageBucket: "greentube-b93d1.appspot.com",
      messagingSenderId: "818380659407",
      appId: "1:818380659407:web:7ee71139590488d78e75ba"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    const params = new URLSearchParams(window.location.search);
    const videoId = params.get("videoId");

    const player = new Plyr("#player", {
      controls: ["play", "progress", "current-time", "mute", "volume", "settings", "fullscreen"]
    });

    const titleEl = document.getElementById("videoTitle");
    const metaEl = document.getElementById("videoMeta");

    <script src="https://www.gstatic.com/firebasejs/11.10.0/firebase-auth-compat.js"></script>

  
    async function loadVideo() {
      if (!videoId) {
        titleEl.innerHTML = "<span class='error'>‚ùå Nie podano ID filmu.</span>";
        return;
      }

      try {
        const ref = db.collection("watch").doc(videoId);
        const snap = await ref.get();

        if (!snap.exists) {
          titleEl.innerHTML = "<span class='error'>‚ùå Nie znaleziono filmu o ID:<br>" + videoId + "</span>";
          return;
        }

        const data = snap.data();
        if (!data.ready) {
          titleEl.innerHTML = "<span class='error'>‚è≥ Film jeszcze siƒô przetwarza...</span>";
          return;
        }

        titleEl.textContent = data.title || "Bez tytu≈Çu";

        const views = (data.views || 0) + 1;
        const created = data.created || Date.now();
        const ageMs = Date.now() - created;
        const ageText = (() => {
          const days = Math.floor(ageMs / 86400000);
          if (days > 0) return `${days} dni temu`;
          const hrs = Math.floor(ageMs / 3600000);
          if (hrs > 0) return `${hrs} godzin temu`;
          const mins = Math.floor(ageMs / 60000);
          return `${mins} minut temu`;
        })();

        metaEl.textContent = `${views} wy≈õwietle≈Ñ ‚Ä¢ ${ageText}`;

        await ref.update({ views: firebase.firestore.FieldValue.increment(1) });

        const videoSrc = data.url.endsWith("/") ? data.url + "video.mp4" : data.url;
        document.getElementById("player").src = videoSrc;

        player.source = {
          type: "video",
          sources: [{ src: videoSrc, type: "video/mp4" }]
        };

      } catch (err) {
        titleEl.innerHTML = `<span class="error">‚ùå B≈ÇƒÖd: ${err.message || err.toString()}</span>`;
      }
    }

    loadVideo();
  </script>
</body>
</html>
